create table Configuracion.CamposEspeciales
(
IdCampoEspecial decimal(20,0),
Nombre varchar(100),
LongitudCampo int,
Estatus bit
)

insert into [Configuracion].CamposEspeciales (IdCampoEspecial,Nombre,LongitudCampo,Estatus) values 
(
1,'Imel',15,1)

SELECT * FROM Configuracion.CamposEspeciales

CREATE PROCEDURE [Configuracion].[SP_BUSCA_CAMPOS_ESPECIALES]
@IdCampoEspecial DECIMAL(20,0) = NULL

AS

SELECT
  CE.IdCampoEspecial
, CE.Nombre
, CE.LongitudCampo
, CE.Estatus AS Estatus0
, CASE CE.Estatus WHEN 1 THEN 'ACTIVO' ELSE 'INACTIVO' END AS Estatus
FROM [Configuracion].[CamposEspeciales] CE
WHERE CE.IdCampoEspecial = ISNULL(@IdCampoEspecial,CE.IdCampoEspecial)

CREATE PROCEDURE [Configuracion].[SP_MODIFICAR_CAMPOS ESPECIALES]
  @IdCampoEspecial DECIMAL(20,0)
, @Nombre VARCHAR(100)
, @LongitudCampo INT
, @Estatus BIT
, @Accion VARCHAR(150)

AS

DECLARE @ITEMS TABLE
(
  IdCampoEspecial DECIMAL(20,0)
, Nombre VARCHAR(100)
, Longitud INT
, Estatus BIT
)

IF(@Accion='UPDATE')
	
	BEGIN
		
		UPDATE [Configuracion].[CamposEspeciales] SET
			
			   Nombre = @Nombre
			, LongitudCampo = @LongitudCampo
			, Estatus = @Estatus
				
				OUTPUT
					
					  inserted.IdCampoEspecial
					, inserted.Nombre
					, inserted.LongitudCampo
					, inserted.Estatus
						
						INTO @ITEMS
							
							WHERE IdCampoEspecial = @IdCampoEspecial
END
SELECT * FROM @ITEMS

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


CREATE PROCEDURE [Inventario].[SP_VALIDAR_REFERENCIA_PRODUCTO]
@Referencia VARCHAR(100) = NULL

AS

SELECT COUNT(*) as Total FROM [Inventario].[Producto] PRO
WHERE PRO.Referencia = ISNULL(@Referencia,PRO.Referencia)
AND PRO.EstatusProducto = 0